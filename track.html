<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Real-Time Order Tracking â€¢ On God Bend Mini Mart</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
:root {
  --brand: #b8860b;
  --bg: #f9f9f9;
  --text: #333;
  --text-light: #777;
  --completed-line: #b8860b;
  --line-bg: #ddd;
}

body {
  font-family: 'Poppins', sans-serif;
  margin: 0; padding: 0;
  background: var(--bg);
  color: var(--text);
}

.container {
  max-width: 800px;
  margin: 40px auto;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
}

h2 { color: var(--brand); text-align: center; margin-bottom: 20px; }

.search-box {
  text-align: center; margin-bottom: 30px;
}

.search-box input { padding: 10px; font-size: 16px; width: 250px; border-radius: 8px; border: 1px solid #ccc; }
.search-box button { padding: 10px 20px; margin-left: 10px; background: var(--brand); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }

.order-details {
  background: #f5f5f5;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 30px;
  display: none;
}

.order-details p { margin: 5px 0; font-size: 16px; }

.tracker {
  display: flex;
  justify-content: space-between;
  position: relative;
  margin-bottom: 30px;
  overflow-x: auto;
  padding-bottom: 10px;
}

.tracker::before {
  content: '';
  position: absolute;
  top: 14px;
  left: 0;
  width: 100%;
  height: 4px;
  background: var(--line-bg);
  z-index: 0;
  border-radius: 2px;
}

.step {
  text-align: center;
  width: 25%;
  min-width: 100px;
  position: relative;
  z-index: 1;
  transition: transform 0.3s;
}

.step .circle {
  width: 28px; height: 28px; border-radius: 50%;
  background: #ddd; margin: 0 auto 8px auto;
  line-height: 28px; color: #fff; font-weight: bold;
  transition: all 0.3s;
}

.step.completed .circle { background: var(--brand); transform: scale(1.2); }
.step.current .circle { border: 2px solid var(--brand); transform: scale(1.4); }

.step p { font-size: 14px; color: var(--text-light); transition: color 0.3s; }
.step.completed p { color: var(--text); font-weight: 600; }
.step.current p { color: var(--brand); font-weight: 700; }

.status-msg { text-align: center; font-size: 18px; margin-bottom: 20px; }

.cancel-btn {
  display: block; width: 200px; margin: 0 auto;
  padding: 10px 20px; background: #e74c3c; color: #fff;
  border: none; border-radius: 8px; cursor: pointer; font-size: 16px;
  transition: background 0.3s;
}
.cancel-btn:hover { background: #c0392b; }

/* Arrow between steps */
.step::after {
  content: '';
  position: absolute;
  top: 14px;
  left: 50%;
  height: 4px;
  width: 100%;
  background: var(--line-bg);
  z-index: -1;
}

.step:last-child::after { display: none; }
.step.completed::after { background: var(--completed-line); }
</style>
</head>
<body>

<div class="container">
  <h2>Track Your Order</h2>

  <div class="search-box">
    <input type="text" id="orderIdInput" placeholder="Enter your Order ID">
    <button onclick="startTracking()">Track</button>
  </div>

  <div class="order-details" id="orderDetails">
    <p><strong>Order ID:</strong> <span id="orderId"></span></p>
    <p><strong>Customer:</strong> <span id="customerName"></span></p>
    <p><strong>Date:</strong> <span id="orderDate"></span></p>

    <div class="tracker" id="tracker">
      <div class="step" data-step="Processing">
        <div class="circle">1</div>
        <p>Pending</p>
      </div>
      <div class="step" data-step="Preparing">
        <div class="circle">2</div>
        <p>Preparing</p>
      </div>
      <div class="step" data-step="On the way">
        <div class="circle">3</div>
        <p>On the way</p>
      </div>
      <div class="step" data-step="Delivered">
        <div class="circle">4</div>
        <p>Delivered</p>
      </div>
    </div>

    <p class="status-msg" id="statusMsg"></p>
    <button class="cancel-btn" onclick="cancelOrder()">Cancel Order</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAwzdua-29Bp19C5_OfXX4PWuCGHsOKfag",
  authDomain: "ongod-5073e.firebaseapp.com",
  projectId: "ongod-5073e",
  storageBucket: "ongod-5073e.firebasestorage.app",
  messagingSenderId: "439687837026",
  appId: "1:439687837026:web:1f752fc79a41e9f5bd283b",
  measurementId: "G-1TVP0X3J62"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let unsubscribe = null;

function startTracking() {
  const orderId = document.getElementById('orderIdInput').value.trim();
  if(!orderId) return alert("Please enter an Order ID");

  if(unsubscribe) unsubscribe();

  unsubscribe = db.collection('Orders').where('orderId', '==', orderId)
    .onSnapshot(snapshot => {
      if(snapshot.empty) { 
        alert("Order not found!"); 
        document.getElementById('orderDetails').style.display = 'none';
        return; 
      }
      snapshot.forEach(doc => {
        const data = doc.data();
        document.getElementById('orderId').innerText = data.orderId;
        document.getElementById('customerName').innerText = data.customerName;

        // Handle Firestore timestamp
        const orderDate = data.date && data.date.toDate ? data.date.toDate().toLocaleString() : data.date;
        document.getElementById('orderDate').innerText = orderDate;

        document.getElementById('orderDetails').style.display = 'block';
        updateTracker(data.status);
      });
    }, err => console.error(err));
}

function updateTracker(status) {
  const steps = document.querySelectorAll('.step');
  const statusMsg = document.getElementById('statusMsg');
  const statusOrder = ["Processing","Preparing","On the way","Delivered"];
  let index = statusOrder.indexOf(status);

  steps.forEach((step, idx) => {
    step.classList.remove('completed','current');
    if(idx < index) step.classList.add('completed');
    if(idx === index) step.classList.add('current');
    step.querySelector('.circle').innerHTML = idx < index ? '<i class="fas fa-check"></i>' : (idx+1);
  });

  statusMsg.innerText = `Current Status: ${status}`;

  // Scroll current step into view (mobile-friendly)
  const currentStep = document.querySelector('.step.current');
  if(currentStep) currentStep.scrollIntoView({behavior: 'smooth', inline: 'center'});
}

function cancelOrder() {
  alert("Order cancellation requested! Implement backend logic here.");
}
</script>
</body>
</html>