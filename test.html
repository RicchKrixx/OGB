<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OGB â€¢ Order Tracking</title>
  <meta name="color-scheme" content="light" />
  <style>
    :root {
      --brand: #b8860b;        /* OGB gold */
      --brand-2: #8b6508;      /* dark gold */
      --ink: #1f1f1f;          /* text */
      --muted: #6b7280;        /* gray-500 */
      --bg: #f6f7fb;           /* page bg */
      --card: #ffffff;         /* card bg */
      --ok: #16a34a;           /* green */
      --warn: #f59e0b;         /* amber */
      --danger: #ef4444;       /* red */
      --line: #e5e7eb;         /* gray-200 */
      --shadow: 0 10px 30px rgba(0,0,0,.06);
      --radius: 16px;
    }* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--ink);
  background: radial-gradient(80% 50% at 50% 0%, #fff 0%, var(--bg) 100%);
}

header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: linear-gradient(180deg, var(--brand), var(--brand-2));
  color: #fff;
  padding: 18px 16px;
  box-shadow: var(--shadow);
}
.wrap { max-width: 1024px; margin: 0 auto; }
.brand {
  display: flex; align-items: center; gap: 10px; font-weight: 800; letter-spacing: .3px;
}
.brand .logo {
  width: 36px; height: 36px; border-radius: 10px; background: #fff2; display: grid; place-items: center; font-size: 18px;
  border: 1px solid #fff3;
}

main { padding: 28px 16px 48px; }
.grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
@media (min-width: 860px){ .grid { grid-template-columns: 1.1fr .9fr; } }

.card { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #f1f5f9; }

.search-card { padding: 18px; display: grid; gap: 14px; }
.search-row { display: grid; grid-template-columns: 1fr auto; gap: 10px; }
input[type="text"] {
  padding: 14px 14px; border-radius: 12px; border: 1px solid var(--line); outline: none; font-size: 16px; background: #fff;
}
input[type="text"]:focus { border-color: var(--brand); box-shadow: 0 0 0 3px #b8860b22; }
button {
  appearance: none; border: 0; cursor: pointer; padding: 14px 16px; border-radius: 12px; font-weight: 700; color: #fff; background: var(--brand);
  box-shadow: 0 6px 16px rgba(184,134,11,.25);
}
button:hover { background: var(--brand-2); }
.hint { color: var(--muted); font-size: 14px; }

.result-card { padding: 0; overflow: hidden; display: none; }
.result-head { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 18px; background: #fafafa; border-bottom: 1px solid var(--line); }
.meta { font-size: 12px; color: var(--muted); }
.meta .v { display: block; font-size: 18px; font-weight: 800; color: var(--ink); margin-top: 4px; }

.content { display: grid; grid-template-columns: 1fr; gap: 18px; padding: 18px; }
@media (min-width: 860px){ .content { grid-template-columns: 1fr; } }

/* PROGRESS TRACKER */
.tracker { position: relative; padding: 8px 0 4px; }
.track-line { position: absolute; left: 17px; top: 8px; bottom: 8px; width: 3px; background: #e9e9ef; border-radius: 2px; }
.step { display: grid; grid-template-columns: 34px 1fr; gap: 12px; position: relative; padding: 10px 0; }
.dot { width: 22px; height: 22px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 0 2px #e9e9ef; background: #cfd8e3; }
.step.completed .dot { background: var(--brand-2); box-shadow: 0 0 0 2px #e1c37b; }
.step.active .dot { background: var(--brand); animation: ping 1.6s infinite; box-shadow: 0 0 0 2px #e1c37b; }
.label { margin-top: 2px; }
.label .t { font-weight: 700; }
.label .s { color: var(--muted); font-size: 13px; }
.time { font-size: 12px; color: var(--muted); margin-top: 4px; }

@keyframes ping { 0% { box-shadow: 0 0 0 2px #e1c37b, 0 0 0 0 rgba(184,134,11,.35); } 70% { box-shadow: 0 0 0 2px #e1c37b, 0 0 0 14px rgba(184,134,11,0); } 100% { box-shadow: 0 0 0 2px #e1c37b, 0 0 0 0 rgba(184,134,11,0); } }

/* ORDER SUMMARY */
.summary { padding: 18px; border-top: 1px dashed var(--line); }
.summary h3 { margin: 0 0 10px; font-size: 18px; }
.row { display: flex; justify-content: space-between; gap: 10px; margin: 6px 0; font-size: 14px; }
.items { margin-top: 12px; border: 1px solid var(--line); border-radius: 12px; overflow: hidden; }
.item { display: grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px 12px; border-top: 1px solid var(--line); }
.item:first-child { border-top: 0; }

/* SIDECARD (ETA + TIPS) */
.side-card { padding: 18px; }
.badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 999px; background: #fff7e6; color: #92400e; border: 1px solid #fde68a; font-weight: 700; font-size: 12px; }
.tips { margin-top: 14px; padding-top: 12px; border-top: 1px dashed var(--line); color: var(--muted); font-size: 14px; }

/* STATES */
.loading { display: none; align-items: center; gap: 8px; color: var(--muted); font-size: 14px; }
.loading .spin { width: 16px; height: 16px; border-radius: 50%; border: 2px solid #e5e7eb; border-top-color: var(--brand); animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg);} }

.error { display: none; padding: 12px; background: #fef2f2; color: #7f1d1d; border: 1px solid #fecaca; border-radius: 12px; }
.empty { padding: 14px; color: var(--muted); text-align: center; }

.toolbar { display: flex; gap: 8px; }
.btn-line { background: #fff; color: var(--brand-2); border: 1px solid #e6e1d3; box-shadow: none; }

.foot { text-align: center; font-size: 12px; color: #9ca3af; margin-top: 18px; }
.a { color: var(--brand-2); text-decoration: none; }

  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <div class="logo">ðŸ›’</div>
      <div>OGB â€¢ Order Tracking</div>
    </div>
  </header>  <main class="wrap">
    <div class="grid">
      <!-- LEFT: Search + Result -->
      <section class="card">
        <div class="search-card">
          <div class="toolbar">
            <input id="orderIdInput" type="text" placeholder="Enter your Order ID (e.g., OGB2482011)" />
            <button id="trackBtn">Track</button>
          </div>          
          <div id="loading" class="loading"><span class="spin"></span> Fetching orderâ€¦</div>
          <div id="error" class="error">Order not found. Please check your Order ID.</div>
        </div><div id="result" class="result-card">
      <div class="result-head">
        <div class="meta">ORDER ID<span class="v" id="vOrderId">â€”</span></div>
        <div class="meta">PLACED ON<span class="v" id="vPlaced">â€”</span></div>
      </div>

      <div class="content">
        <div>
          <div class="tracker" id="tracker">
            <div class="track-line"></div>
            <!-- Steps will be injected here -->
          </div>

          <div class="summary">
            <h3>Order Summary</h3>
            <div class="row"><span>Customer</span><strong id="vCustomer">â€”</strong></div>
            <div class="row"><span>Phone</span><strong id="vPhone">â€”</strong></div>
            <div class="row"><span>Payment</span><strong id="vPayment">â€”</strong></div>
            <div class="items" id="items"></div>
            <div class="row" style="margin-top:10px"><span>Total</span><strong id="vTotal">â€”</strong></div>
          </div>
        </div>
      </div>
    </div>

    <div class="foot">Having trouble? Contact <a class="a" href="tel:+233000000000">OGB Support</a></div>
  </section>

  <!-- Tips -->
  <aside class="card side-card">
    <div class="tips">
      â€¢ Keep your phone on. The rider may call you.<br/>
      â€¢ Youâ€™ll receive SMS/WhatsApp updates for major status changes.<br/>
      â€¢ Share the tracking link with a friend or family member.
    </div>
    <div style="margin-top:14px; display:flex; gap:8px;">
      <button id="copyLink" class="btn-line">Copy Link</button>
      <button id="refresh" class="btn-line">Refresh</button>
    </div>
  </aside>
</div>

  </main>  <script type="module">
    // -------- Firebase (Modular SDK) --------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, onSnapshot, getDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 1) Replace these with your Firebase project's values
     const firebaseConfig = {
  apiKey: "AIzaSyAwzdua-29Bp19C5_OfXX4PWuCGHsOKfag",
  authDomain: "ongod-5073e.firebaseapp.com",
  projectId: "ongod-5073e",
  storageBucket: "ongod-5073e.firebasestorage.app",
  messagingSenderId: "439687837026",
  appId: "1:439687837026:web:1f752fc79a41e9f5bd283b",
  measurementId: "G-1TVP0X3J62"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // -------- DOM Helpers --------
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    const orderIdInput = $("#orderIdInput");
    const trackBtn = $("#trackBtn");
    const resultCard = $("#result");
    const loadingEl = $("#loading");
    const errorEl = $("#error");

    const vOrderId = $("#vOrderId");
    const vPlaced = $("#vPlaced");
    const vCustomer = $("#vCustomer");
    const vPhone = $("#vPhone");
    const vPayment = $("#vPayment");
    const vTotal = $("#vTotal");
    const trackerEl = $("#tracker");
    const itemsEl = $("#items");

    const refreshBtn = $("#refresh");
    const copyBtn = $("#copyLink");
    const sampleLink = $("#sampleLink");

    // status steps (keys expected in Firestore's `status` field)
    const STEPS = [
      { key: "Pending", title: "Pending", sub: "We got your order." },
      { key: "Preparing", title: "Preparing", sub: "Packaging your items." },
      { key: "Ontheway", title: "Out for Delivery", sub: "Rider is on the way." },
      { key: "Delivered", title: "Delivered", sub: "Order delivered." },
{ key: "Complete", title: "Completed", sub: "Order completed." }
    ];

    let unsub = null; // onSnapshot unsubscribe
    let countdownTimer = null;

    function setLoading(yes){ loadingEl.style.display = yes ? 'flex' : 'none'; }
    function setError(msg){ errorEl.textContent = msg; errorEl.style.display = 'block'; }
    function clearError(){ errorEl.style.display = 'none'; }

    function formatMoney(n, currency = 'GHS'){
      try { return new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(n); }
      catch { return `${currency} ${(+n).toFixed(2)}` }
    }

    function formatDate(ts){
      if (!ts) return 'â€”';
      try {
        const d = ts instanceof Timestamp ? ts.toDate() : new Date(ts);
        return d.toLocaleString();
      } catch { return 'â€”'; }
    }

    function buildTracker(currentKey, timestamps={}){
      trackerEl.innerHTML = '';
      const currentIndex = Math.max(0, STEPS.findIndex(s => s.key === currentKey));
      STEPS.forEach((s, i) => {
        const st = document.createElement('div');
        st.className = 'step' + (i < currentIndex ? ' completed' : i === currentIndex ? ' active' : '');
        st.innerHTML = `
          <div class="dot"></div>
          <div class="label">
            <div class="t">${s.title}</div>
            <div class="s">${s.sub}</div>
            <div class="time">${formatDate(timestamps?.[s.key])}</div>
          </div>`;
        trackerEl.appendChild(st);
      });
    }

    function renderItems(items=[]) {
      itemsEl.innerHTML = '';
      if (!items.length){ itemsEl.innerHTML = '<div class="empty">No items</div>'; return; }
      items.forEach(it => {
        const row = document.createElement('div');
        row.className = 'item';
        const name = `${it.name || 'Item'} Ã— ${it.qty || 1}`;
        const price = formatMoney(it.total ?? (it.price||0) * (it.qty||1));
        row.innerHTML = `<div>${name}</div><div><strong>${price}</strong></div>`;
        itemsEl.appendChild(row);
      });
    }

    async function fetchAndListen(orderId){
      // clean previous subscription
      if (unsub) { unsub(); unsub = null; }

      setLoading(true); clearError(); resultCard.style.display = 'none';

      const ref = doc(db, 'orders', orderId);
      const snap = await getDoc(ref);
      if (!snap.exists()){
        setLoading(false);
        setError('Order not found. Please check your Order ID.');
        return;
      }

      // live listener
      unsub = onSnapshot(ref, (docSnap) => {  
    const data = docSnap.data();  
    setLoading(false); clearError(); resultCard.style.display = 'block';  

    vOrderId.textContent = orderId;  
    vPlaced.textContent = formatDate(data.createdAt);  
    vCustomer.textContent = data.customer?.name || 'â€”';  
    vPhone.textContent = data.customer?.phone || 'â€”';  
    vPayment.textContent = (data.paymentMethod || 'â€”').toString();  

    const currency = data.currency || 'GHS';  
    vTotal.textContent = formatMoney(Number(data.total || 0), currency);  

    buildTracker(data.status || 'Pending', data.timestamps || {});  
    renderItems(Array.isArray(data.items) ? data.items : []);  

    }, (err) => {  
    setLoading(false);  
    setError('Failed to subscribe to updates. Please retry.');  
    console.error(err);  
  });  
}  
    function setParam(orderId){
      const url = new URL(location.href);
      url.searchParams.set('orderId', orderId);
      history.replaceState(null, '', url);
    }

    function getParam(){ return new URL(location.href).searchParams.get('orderId'); }

    // UI handlers
    trackBtn.addEventListener('click', () => {
      const id = orderIdInput.value.trim();
      if (!id) return;
      setParam(id); fetchAndListen(id);
    });

    orderIdInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter'){ trackBtn.click(); }
    });

    refreshBtn.addEventListener('click', () => {
      const id = orderIdInput.value.trim() || getParam();
      if (id) fetchAndListen(id);
    });

    copyBtn.addEventListener('click', async () => {
      const id = orderIdInput.value.trim() || getParam();
      if (!id) return;
      const url = `${location.origin}${location.pathname}?orderId=${encodeURIComponent(id)}`;
      try { await navigator.clipboard.writeText(url); copyBtn.textContent = 'Copied!'; setTimeout(()=>copyBtn.textContent='Copy Link', 1200); }
      catch { alert(url); }
    });

    // Deep-link on load
    const qp = getParam();
    const sample = `${location.origin}${location.pathname}?orderId=OGB123456`;
    sampleLink.textContent = sample; sampleLink.href = sample; sampleLink.target = '_blank';

    if (qp){ orderIdInput.value = qp; fetchAndListen(qp); }
  </script>
</body>
</html>