<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Orders â€¢ On God Bend Mini Mart</title>
<style>
:root {
  --brand: #b8860b; 
  --brand-dark: #8b6508;
  --ink: #1f1f1f;
  --bg: #f7f7f9;
  --card: #ffffff;
}
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--ink);
}
header {
  background: var(--brand);
  color: #fff;
  padding: 1rem;
  font-size: 1.25rem;
  font-weight: bold;
  text-align: center;
}
.order-list {
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.order {
  background: var(--card);
  padding: 1rem;
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.order h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
  color: var(--brand-dark);
}
.order p {
  margin: 0.25rem 0;
  font-size: 0.9rem;
}

/* ðŸ”” Full screen NEW ORDER overlay */
#newOrderOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: var(--brand);
  color: white;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: bold;
  z-index: 9999;
  cursor: pointer;
}
</style>
</head>
<body>
<header>Orders â€¢ On God Bend Mini Mart</header>
<div class="order-list" id="orderList">Loading orders...</div>

<!-- ðŸ”” Overlay -->
<div id="newOrderOverlay">NEW ORDER</div>

<!-- ðŸ”Š Notification sound -->
<audio id="notifSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script type="module">
  // Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_APP.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const orderList = document.getElementById("orderList");
  const overlay = document.getElementById("newOrderOverlay");
  const sound = document.getElementById("notifSound");

  let firstLoad = true;
  let seenOrders = new Set();

  function showNewOrderAlert() {
    overlay.style.display = "flex";
    sound.play().catch(()=>{}); // ignore autoplay block
    const hide = () => {
      overlay.style.display = "none";
      overlay.removeEventListener("click", hide);
    };
    setTimeout(hide, 3000);
    overlay.addEventListener("click", hide);
  }

  const q = query(collection(db, "Orders"), orderBy("timestamp", "desc"));
  onSnapshot(q, snapshot => {
    orderList.innerHTML = "";
    snapshot.forEach(doc => {
      const order = doc.data();
      const div = document.createElement("div");
      div.className = "order";
      div.innerHTML = `
        <h3>Order #${doc.id}</h3>
        <p><strong>Name:</strong> ${order.name || "â€”"}</p>
        <p><strong>Items:</strong> ${order.items || "â€”"}</p>
        <p><strong>Total:</strong> ${order.total || "â€”"}</p>
      `;
      orderList.appendChild(div);

      // âœ… New order detection
      if (!firstLoad && !seenOrders.has(doc.id)) {
        showNewOrderAlert();
      }
      seenOrders.add(doc.id);
    });
    firstLoad = false;
  });
</script>
</body>
</html>