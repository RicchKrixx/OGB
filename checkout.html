<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout ‚Ä¢ On God Bend Mini Mart</title>
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --brand: #b8860b; 
      --brand-dark: #8b6508;
      --ink: #1f1f1f;
      --bg: #f7f7f9;
      --card: #ffffff;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--ink); }
    a { color: inherit; text-decoration: none; }

    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 16px; background: #111; color: #fff;
    }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand img { height: 44px; width: auto; border-radius: 6px; }
    .nav { display: flex; gap: 14px; }
    .nav a { padding: 8px 10px; border-radius: 8px; }
    .nav a:hover { background: rgba(255,255,255,.08); }
    .cart-btn { display: inline-flex; align-items: center; gap: 8px; background: var(--brand); color:#fff; border:0; border-radius:10px; padding:8px 12px; font-weight:600; cursor:pointer; }
    .badge { background:#111; color:#fff; border-radius:999px; padding:2px 8px; font-size:12px; }

    #checkout { padding:26px 16px; max-width:900px; margin:0 auto 26px; }
    form.checkout { background:#fff; border-radius:16px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .fields { display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); }
    input, select, textarea { width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; }
    .order-summary { margin-top:16px; background:#fafafa; border-radius:12px; padding:12px; }
    .pay-row { display:flex; gap:12px; flex-wrap:wrap; margin:12px 0; }
    .place { width:100%; background:#111; color:#fff; border:0; border-radius:12px; padding:12px 14px; font-weight:800; cursor:pointer; }
    .note { font-size:12px; color:#666; }
    .success { background:#e9ffe9; border:1px solid #a7e7a7; color:#0a5d0a; padding:12px; border-radius:12px; margin-top:12px; display:none; }
    footer { padding:24px 16px; text-align:center; background:#111; color:#bbb; margin-top:26px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="https://i.postimg.cc/bJRyWDhS/file-000000003574620aa7b29924f4c1965a.png" alt="On God Bend Logo"/>
    </div>
    <nav class="nav">
      <a href="index.html#products">Shop</a>
      <a href="index.html#contact">Contact</a>
      <a href="cart.html" class="cart-btn">üõí Cart <span class="badge" id="cartCount">0</span></a>
    </nav>
  </header>

  <section id="checkout" class="section">
    <h2>Checkout</h2>
    <form class="checkout" onsubmit="return submitOrder(event)">
      <div class="fields">
        <div><label>Full Name</label><input id="name" required /></div>
        <div><label>Phone</label><input id="phone" required /></div>
        <div><label>Email</label><input id="email" type="email" placeholder="(optional)" /></div>
        <div style="grid-column:1/-1"><label>Delivery Address</label><input id="address" required /></div>
      </div>

      <div class="order-summary" id="orderSummary"></div>

      <div class="pay-row">
        <label><input type="radio" name="pay" value="pod" checked /> Pay on Delivery</label>
        <label><input type="radio" name="pay" value="paystack" /> Pay with Paystack</label>
      </div>

      <button class="place" type="submit">Place Order</button>
      <div class="note">Online payment uses Paystack. Configure your public key in cart.js.</div>
      <div class="success" id="successBox"></div>
    </form>
  </section>

  <footer>
    ¬© <span id="year"></span> On God Bend Mini Mart, Wine & Liquor ‚Äî All Rights Reserved.
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

   
// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAwzdua-29Bp19C5_OfXX4PWuCGHsOKfag",
  authDomain: "ongod-5073e.firebaseapp.com",
  projectId: "ongod-5073e",
  storageBucket: "ongod-5073e.firebasestorage.app",
  messagingSenderId: "439687837026",
  appId: "1:439687837026:web:1f752fc79a41e9f5bd283b",
  measurementId: "G-1TVP0X3J62"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 2Ô∏è‚É£ Render cart items
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const summaryEl = document.getElementById("orderSummary");
    let total = 0;
    if(cart.length === 0) summaryEl.innerHTML = "<p>Your cart is empty.</p>";
    else {
      summaryEl.innerHTML = "";
      cart.forEach(item => {
        const p = document.createElement("p");
        p.textContent = `${item.name} x${item.quantity} ‚Äî GHS ${item.price * item.quantity}`;
        summaryEl.appendChild(p);
        total += item.price * item.quantity;
      });
      const t = document.createElement("p");
      t.innerHTML = `<b>Total:</b> GHS ${total}`;
      summaryEl.appendChild(t);
    }

    // 3Ô∏è‚É£ Submit order
    async function submitOrder(e) {
      e.preventDefault();
      if(cart.length === 0){ alert("Your cart is empty!"); return; }

      const orderData = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value || "",
        address: document.getElementById("address").value,
        items: cart,
        total: total,
        date: new Date().toLocaleString(),
        payment: document.querySelector('input[name="pay"]:checked').value
      };

      try {
        // Save to Firestore
        const docRef = await db.collection("orders").add(orderData);

        if(orderData.payment === "paystack") {
          // Paystack integration
          let handler = PaystackPop.setup({
            key: 'YOUR_PAYSTACK_PUBLIC_KEY',
            email: orderData.email || "customer@example.com",
            amount: total * 100,
            currency: "GHS",
            ref: docRef.id,
            onClose: function(){ alert('Payment window closed.'); },
            callback: function(response){
              document.getElementById("successBox").style.display="block";
              document.getElementById("successBox").textContent = "Payment successful! Order ID: " + docRef.id;
              localStorage.removeItem("cart");
            }
          });
          handler.openIframe();
        } else {
          document.getElementById("successBox").style.display="block";
          document.getElementById("successBox").textContent = "Order placed successfully! Order ID: " + docRef.id;
          localStorage.removeItem("cart");
        }
      } catch(err){
        console.error(err);
        alert("Failed to place order. Try again.");
      }
      return false;
    }
  </script>
</body>
</html>