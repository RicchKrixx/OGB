<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>On God Bend Mart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Paystack -->
  <script src="https://js.paystack.co/v1/inline.js"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:#f5f5f5; }
    h2 { margin-top: 30px; }
    .section { background:#fff; padding:20px; margin:10px 0; border-radius:8px; }
    input, button { padding:10px; margin:5px 0; width:100%; }
    button { background:#008cff; color:#fff; border:none; border-radius:5px; cursor:pointer; }
    #cartItems li { margin:5px 0; }
    #receipt, #trackResult { white-space: pre-wrap; background:#fafafa; padding:10px; border:1px solid #ccc; border-radius:5px; }
  </style>
</head>
<body>

  <h1>ðŸ›’ On God Bend Mini Mart</h1>

  <!-- Products -->
  <div class="section">
    <h2>Products</h2>
    <button onclick="addToCart({name:'Red Wine', price:50})">Add Red Wine (â‚µ50)</button>
    <button onclick="addToCart({name:'Milo Tin', price:25})">Add Milo (â‚µ25)</button>
  </div>

  <!-- Cart -->
  <div class="section">
    <h2>Cart</h2>
    <ul id="cartItems"></ul>
    <p><b>Total:</b> â‚µ<span id="cartTotal">0</span></p>
  </div>

  <!-- Checkout -->
  <div class="section">
    <h2>Checkout</h2>
    <input id="name" placeholder="Full Name">
    <input id="phone" placeholder="Phone">
    <input id="email" placeholder="Email">
    <input id="address" placeholder="Address">
    <label><input type="radio" name="payment" value="Pay on Delivery" checked> Pay on Delivery</label>
    <label><input type="radio" name="payment" value="Paystack"> Pay with Paystack</label>
    <button onclick="placeOrder()">Place Order</button>
  </div>

  <!-- Thank You & Receipt -->
  <div class="section" id="thankyou" style="display:none;">
    <h2>âœ… Order Placed</h2>
    <p>Your Order ID: <b id="orderIdText"></b></p>
    <h3>Receipt</h3>
    <div id="receipt"></div>
  </div>

  <!-- Order Tracking -->
  <div class="section">
    <h2>Track Order</h2>
    <input id="trackId" placeholder="Enter Order ID">
    <button onclick="trackOrder()">Track</button>
    <div id="trackResult"></div>
  </div>

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAwzdua-29Bp19C5_OfXX4PWuCGHsOKfag",
    authDomain: "ongod-5073e.firebaseapp.com",
    projectId: "ongod-5073e",
    storageBucket: "ongod-5073e.firebasestorage.app",
    messagingSenderId: "439687837026",
    appId: "1:439687837026:web:1f752fc79a41e9f5bd283b",
    measurementId: "G-1TVP0X3J62"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ------------------- Cart -------------------
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  function updateCart() {
    let cartList = document.getElementById("cartItems");
    cartList.innerHTML = "";
    let total = 0;
    cart.forEach(item => {
      total += item.price;
      cartList.innerHTML += `<li>${item.name} - â‚µ${item.price}</li>`;
    });
    document.getElementById("cartTotal").innerText = total;
    localStorage.setItem("cart", JSON.stringify(cart));
    localStorage.setItem("cartTotal", total);
  }
  function addToCart(product) {
    cart.push(product);
    updateCart();
  }
  updateCart();

  // ------------------- Place Order -------------------
  async function placeOrder() {
    let name = document.getElementById("name").value;
    let phone = document.getElementById("phone").value;
    let email = document.getElementById("email").value;
    let address = document.getElementById("address").value;
    let paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    let total = localStorage.getItem("cartTotal") || 0;
    let orderId = "ORD" + Date.now();

    let orderData = {
      orderId, customerName: name, phone, email, address,
      items: cart, totalAmount: total,
      paymentMethod, status: paymentMethod==="Paystack" ? "paid" : "pending",
      createdAt: new Date().toISOString()
    };

    if (paymentMethod === "Paystack") {
      payWithPaystack(email, total, orderData);
    } else {
      await saveOrder(orderData);
    }
  }

  // ------------------- Save Order to Firestore -------------------
  async function saveOrder(orderData) {
    await db.collection("orders").doc(orderData.orderId).set(orderData);
    showThankYou(orderData);
    cart = [];
    updateCart();
  }

  // ------------------- Paystack -------------------
  function payWithPaystack(email, total, orderData) {
    let handler = PaystackPop.setup({
      key: "YOUR_PUBLIC_KEY", // Replace with your Paystack public key
      email: email,
      amount: total * 100, // Convert to pesewas
      currency: "GHS",
      callback: function(response) {
        orderData.status = "paid";
        saveOrder(orderData);
      },
      onClose: function() {
        alert("Payment cancelled");
      }
    });
    handler.openIframe();
  }

  // ------------------- Thank You & Receipt -------------------
  function showThankYou(order) {
    document.getElementById("thankyou").style.display = "block";
    document.getElementById("orderIdText").innerText = order.orderId;
    document.getElementById("receipt").innerText = JSON.stringify(order, null, 2);
  }

  // ------------------- Tracking -------------------
  async function trackOrder() {
    let trackId = document.getElementById("trackId").value.trim();
    if (!trackId) return alert("Enter Order ID");
    let doc = await db.collection("orders").doc(trackId).get();
    if (doc.exists) {
      document.getElementById("trackResult").innerText = JSON.stringify(doc.data(), null, 2);
    } else {
      document.getElementById("trackResult").innerText = "No order found.";
    }
  }
</script>
</body>
</html>